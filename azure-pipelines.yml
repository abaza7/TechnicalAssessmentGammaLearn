trigger:
- master   # or main, depending on your branch name

pool:
  vmImage: 'ubuntu-latest'

steps:
# Install Java 17
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

# Install Chrome + ChromeDriver
- script: |
    sudo apt-get update
    sudo apt-get install -y wget unzip xvfb
    sudo apt-get install -y google-chrome-stable || true
    CHROME_VERSION=$(google-chrome --version | sed 's/Google Chrome //' | cut -d '.' -f 1)
    wget https://chromedriver.storage.googleapis.com/${CHROME_VERSION}.0.0/chromedriver_linux64.zip -O chromedriver.zip || true
    sudo unzip chromedriver.zip -d /usr/local/bin
    sudo chmod +x /usr/local/bin/chromedriver
  displayName: 'Install Chrome & ChromeDriver'

# Run Selenium Tests using your POM path
- script: |
    mvn -f TechnicalAssessmentGammaLearn/functionalTestsProject/pom.xml clean test -Dheadless=true
  displayName: 'Run Selenium Tests'

# Publish Test Results
- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/surefire-reports/*.xml'
    failTaskOnFailedTests: true
  displayName: 'Publish Test Results'
